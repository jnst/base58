# Base58 Performance Benchmarks

このドキュメントは、base58ライブラリのパフォーマンス特性をまとめています。

## ベンチマーク環境

- **CPU**: Apple M2
- **OS**: macOS (darwin/arm64)
- **Go Version**: 1.24

## ベンチマーク結果

### エンコード性能

| データサイズ | 実行時間 (ns/op) | メモリ使用量 (B/op) | アロケーション回数 |
|-------------|-----------------|-------------------|------------------|
| 8B          | 287 ns         | 128 B             | 14 allocs        |
| 32B         | 1,591 ns       | 504 B             | 46 allocs        |
| 64B         | 4,121 ns       | 976 B             | 89 allocs        |
| 256B        | 40,076 ns      | 3,752 B           | 344 allocs       |
| 1KB         | 534,117 ns     | 15,088 B          | 1,377 allocs     |
| 4KB         | 8,204,280 ns   | 61,009 B          | 5,485 allocs     |
| 16KB        | 129,117,562 ns | 243,624 B         | 22,008 allocs    |

### デコード性能

| データサイズ | 実行時間 (ns/op) | メモリ使用量 (B/op) | アロケーション回数 |
|-------------|-----------------|-------------------|------------------|
| 8B          | 289 ns         | 72 B              | 4 allocs         |
| 32B         | 1,199 ns       | 120 B             | 4 allocs         |
| 64B         | 2,513 ns       | 280 B             | 5 allocs         |
| 256B        | 11,284 ns      | 1,720 B           | 10 allocs        |
| 1KB         | 68,390 ns      | 17,016 B          | 29 allocs        |
| 4KB         | 693,650 ns     | 237,177 B         | 106 allocs       |
| 16KB        | 9,393,828 ns   | 3,595,950 B       | 413 allocs       |

### ラウンドトリップ性能

| データサイズ | 実行時間 (ns/op) | メモリ使用量 (B/op) | アロケーション回数 |
|-------------|-----------------|-------------------|------------------|
| 32B         | 3,029 ns       | 632 B             | 51 allocs        |
| 256B        | 51,371 ns      | 5,520 B           | 360 allocs       |
| 1KB         | 606,972 ns     | 32,120 B          | 1,408 allocs     |

### 特殊ケース

| ケース         | 実行時間 (ns/op) | メモリ使用量 (B/op) | アロケーション回数 |
|---------------|-----------------|-------------------|------------------|
| 空データ       | 1.99 ns        | 0 B               | 0 allocs         |
| 全て0バイト    | 905 ns         | 752 B             | 63 allocs        |
| 全て1バイト    | 1,591 ns       | 512 B             | 47 allocs        |
| 空文字列       | 1.93 ns        | 0 B               | 0 allocs         |
| 全て'1'文字    | 33.1 ns        | 48 B              | 1 allocs         |

## パフォーマンス分析

### エンコード
- **時間計算量**: O(n)（nはデータサイズ）
- **メモリ使用量**: データサイズに比例して増加
- **スループット**: 
  - 小さなデータ（32B）: ~20 MB/s
  - 中サイズデータ（1KB）: ~1.9 MB/s
  - 大きなデータ（16KB）: ~0.12 MB/s

### デコード
- **時間計算量**: O(n)（nは文字列長）
- **メモリ効率**: エンコードより優秀
- **スループット**:
  - 小さなデータ（32B）: ~27 MB/s
  - 中サイズデータ（1KB）: ~15 MB/s
  - 大きなデータ（16KB）: ~1.7 MB/s

### 最適化ポイント
1. **大きなデータの処理**: 16KB以上では性能が大幅に低下
2. **メモリアロケーション**: データサイズの増加に伴い、アロケーション回数が急激に増加
3. **特殊ケース**: 空データや先頭0バイトの処理は非常に高速

## ベンチマークの実行方法

```bash
# 全ベンチマーク実行
make bench

# 安定性チェック（3回実行）
make bench-stability

# 結果をファイルに保存
make bench-save

# 個別ベンチマーク
go test -bench=BenchmarkEncode_32B -benchmem
go test -bench=BenchmarkDecode -benchmem
go test -bench=BenchmarkRoundTrip -benchmem
```

## ベンチマーク比較

他のBase58実装との比較を行う場合は、同一環境で以下のコマンドを実行：

```bash
go test -bench=. -benchmem -count=5 | tee benchmark_results.txt
```